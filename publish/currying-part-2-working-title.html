<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />
    <title>Currying Part 2 (Working Title)</title>
    <meta name="description" content="bouwe.io, a blog by Bouwe Westerdijk" />
    <meta name="image" content="/bouwe-react-amsterdam.png" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="bouwe.io" />
    <meta property="og:url" content="https://bouwe.io" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="bouwe.io" />
    <meta
      property="og:description"
      content="bouwe.io, a blog by Bouwe Westerdijk"
    />
    <meta
      property="og:image"
      content="https://bouwe.io/bouwe-react-amsterdam.png"
    />
    <meta property="og:image:alt" content="Bouwe Westerdijk" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@bouwe" />
    <meta name="twitter:url" content="https://bouwe.io" />
    <meta name="twitter:title" content="Currying Part 2 (Working Title)" />
    <meta
      name="twitter:description"
      content="bouwe.io, a blog by Bouwe Westerdijk"
    />
    <meta
      name="twitter:image"
      content="https://bouwe.io/bouwe-react-amsterdam"
    />
    <meta name="twitter:image:alt" content="Bouwe Westerdijk" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="/styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Open Sans"
    />
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.1/build/styles/atom-one-dark-reasonable.min.css"
    />
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.1/build/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <link
      href="/rss2.xml"
      type="application/rss+xml"
      rel="alternate"
      title="bouwe.io RSS Feed"
    />
    <link
      href="/atom.xml"
      type="application/atom+xml"
      rel="alternate"
      title="bouwe.io Atom feed"
    />
  </head>

  <body>
  <div>
    <header class="header">
      <div class="container">
        <div class="header-container">
          <div class="logo">
            <h1>
              <a href="/"
                ><span class="logo-part1">bouwe</span
                ><span class="logo-part2">.io</span></a
              >
            </h1>
          </div>
          <div class="nav"><ul class='nav-list'><li class='nav-item'><a href="/about" class='nav-inactive'>about</a></li><li class='nav-item'><a href="/blog" class='nav-active'>blog</a></li><li class='nav-item'><a href="/workshops" class='nav-inactive'>workshops</a></li><li class='nav-item'><a href="/links" class='nav-inactive'>links</a></li><li class='nav-item'><a href="/contact" class='nav-inactive'>contact</a></li></ul></div>
        </div>
      </div>
    </header>

    <div class="main">
      <div class="container">
        <div>
          <h2 class="blog-title">
            <a href="/currying-part-2-working-title">Currying Part 2 (Working Title)</a>
          </h2>
          <div class="blog-meta">
            Mar 21, 2021  路 <a href="/categories/functional-programming">Functional programming</a>, <a href="/categories/javascript">JavaScript</a>, <a href="/categories/currying">Currying</a>  路 4 minute read
          </div>
        </div>

        <div><h4>Introduction</h4>
<p>Bla bla bla... In ieder geval composition noemen.</p>
<p>So if you don't know what currying is, please read <a href="/currying-what-is-it-and-what-is-it-good-for">Part 1</a> where I try to explain it and which also contains some links to other resources that explain currying very well.</p>
<h4>Logging continued</h4>
<p>In this blog post we'll continue on the logging functionality we started with in <a href="/currying-what-is-it-and-what-is-it-good-for">Part 1</a>. I changed the code a bit, now the <code>log</code> function is split into a function that formats the log message and one that writes a message to the console. I also added a function that writes a message to a file:</p>
<pre><code class="language-js">function formatLog(datetime, severity, message) {
  return `${datetime} [${severity}] - ${message}`;
}

function writeToConsole(message) {
  console.log(message);
  return message;
}

function writeToFile(filePath, message) {
  fs.appendFile(filePath, message + "\n", (err) => {
    if (err) throw err;
  });
  return message;
}
</code></pre>
<p>What we can do now is call and combine different functions to achieve what we want by nesting them:</p>
<pre><code class="language-js">// Write a log message to the console:
writeToConsole(formatLog(new Date().toISOString(), "INFO", "Hello World"));

// Write a log message to a file:
writeToFile(
  "/path/to/file",
  formatLog(new Date().toISOString(), "INFO", "Hello World")
);

// Write a log message to both the console and a file:
writeToFile(
  "/path/to/file",
  writeToConsole(formatLog(new Date().toISOString(), "INFO", "Hello World"))
);
</code></pre>
<p>Nesting the function calls like this is not particularly readable and I am not composing anything.</p>
<h4>Piping and composition</h4>
<p>What I would like to do instead is compose a new function that does the nesting for me, so I only need to mention which functions I want to be called in sequence, making my code look nicer. This is a form of composition that is called piping:</p>
<pre><code class="language-js">// Compose a new function by piping (or chaining) some functions into a new function that does logging for us:
const logInfoToFile = pipe(formatLog, writeToConsole, writeToFile);

// Call the function we just composed to do some logging:
logInfoToFile("Hello World");
</code></pre>
<p>The code above does not work, because we haven't defined the <code>pipe</code> function yet. But because we are doing functional programming, this code is already quite easy to reason about.</p>
<p>This is the <code>pipe</code> function:</p>
<pre><code class="language-js">const pipe = (...fns) => (x) => fns.reduce((y, f) => f(y), x);
</code></pre>
<blockquote>
<p>Just like the <code>curry</code> function I showed you in <a href="/currying-what-is-it-and-what-is-it-good-for">Part 1</a>, also the <code>pipe</code> function is probably not something you'd build yourself, but use from libraries like <a href="https://lodash.com">Lodash</a>, <a href="https://ramdajs.com">Ramda</a>, etc.</p>
</blockquote>
<p>What the <code>pipe</code> function does is composing a function that calls the provided functions nested, just like we did by hand earlier. The only thing we did is abstracted that away, for convenience, but also to keep our code clean.</p>
<p>However, something is missing in the code example where I showed how to pipe and log. We pass three functions to pipe and then call the <code>logInfoToFile</code> and only pass a message. But what about all the other arguments, like the <code>datetime</code> and <code>severity</code> for <code>formatLog</code> and the <code>filepath</code> for the <code>writeToFile</code> function?</p>
<p>To be able to do piping, or rather, composing in general, we need a predictable interface for each function, so they always <em>fit</em> together. And the only way to achieve that is by requiring that every function not only always returns a value, but also it always expects exactly one parameter.</p>
<p>That way, the return value from the first function is the argument for the next, which also returns one value, that is passed to the next function, etc., and so you can combine any number of functions you want.</p>
<p>However, the <code>formatLog</code> and <code>writeToFile</code> need multiple arguments, so they are not suitable for composition yet.</p>
<h4>Currying to the rescue!</h4>
<p>In my <a href="/currying-what-is-it-and-what-is-it-good-for">previous blog about currying</a> I showed you how we can transform any function to a curried function so that it can only receive one argument at a time. So that's what we are going to do now to solve our composition problem.</p>
<p>Here is the <code>curry</code> function from that blog post and we'll use it to curry both the <code>log</code> and <code>writeToFile</code> functions, so we can partially apply them with the <code>logInfo</code> and <code>writeToLogFile</code> functions, respectively:</p>
<pre><code class="language-js">function curry(fn) {
  return function curried(...args) {
    if (args.length >= fn.length) return fn(...args);
    return function (a) {
      return curried(...[...args, a]);
    };
  };
}

const curriedFormatLog = curry(formatLog);
const datetime = { toString: () => newDate().toISOString() };
const formatLogInfo = curriedFormatLog(datetime)("INFO");

const curriedWriteToFile = curry(writeToFile);
const writeToLogFile = curriedWriteToFile("/path/to/file");
</code></pre>
<p>The <code>formatLogInfo</code> function already passes two of the three arguments that <code>formatLog</code> expects, so there is only one (<code>message</code>) left. The same for <code>writeToLogFile</code>, which already passes file path, so also there only the <code>message</code> is left.</p>
<p>Now we can pipe the logging functions like this so the return value of each function is passed as an argument to the next function:</p>
<pre><code class="language-js">// Pipe (or chain) some functions into a new function that does logging for us:
const logInfoToFile = pipe(formatLogInfo, writeToConsole, writeToLogFile);

// Let's do some logging:
logInfoToFile("Hello World");
</code></pre>
<h4>Conclusion</h4>
<p>Iets zeggen over dat we code declaratief hebben gemaakt, het gaat er om dat je allemaal functions maakt en die aanroept, zodat het een leesbaar geheel wordt van stapjes die elkaar aanroepen.</p>
<p>Ook dat deze code niet production ready is, het is vooral illustratief.</p>
<p>Doordat ik er inmiddels best veel mee geoefend heb, komt het steeds beter in mijn systeem en zie ik steeds meer toepassingen...</p>
<p>Links</p>
<ul>
<li><a href="https://medium.com/javascript-scene/curry-and-function-composition-2c208d774983">Curry and Function Composition</a> by Eric Elliott.</li>
</ul>
</div>

        <div>
          <a
            href="https://twitter.com/intent/tweet?text=Currying Part 2 (Working Title)&url=https://bouwe.io/currying-part-2-working-title&via=bouwe"
            >Share on Twitter</a
          >
          路
          <a href="https://twitter.com/search?q=https://bouwe.io/currying-part-2-working-title"
            >Discuss on Twitter</a
          >
          路
          <a href="https://github.com/bouwe77/bouwe.io/edit/master/content/blog/currying-part-2-working-title/currying-part-2-working-title.md">Edit on GitHub</a>
        </div>
      </div>
    </div>

    <footer></footer>
  </div>
</body>

</html>

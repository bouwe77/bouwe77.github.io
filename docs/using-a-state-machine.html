<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />
    <title>Using a state machine</title>
    <meta name="description" content="bouwe.io, a blog by Bouwe Westerdijk" />
    <meta name="image" content="/bouwe-react-amsterdam.png" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="bouwe.io" />
    <meta property="og:url" content="https://bouwe.io" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="bouwe.io" />
    <meta
      property="og:description"
      content="bouwe.io, a blog by Bouwe Westerdijk"
    />
    <meta
      property="og:image"
      content="https://bouwe.io/bouwe-react-amsterdam.png"
    />
    <meta property="og:image:alt" content="Bouwe Westerdijk" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content="@bouwe" />
    <meta name="twitter:url" content="https://bouwe.io" />
    <meta name="twitter:title" content="Using a state machine" />
    <meta
      name="twitter:description"
      content="bouwe.io, a blog by Bouwe Westerdijk"
    />
    <meta
      name="twitter:image"
      content="https://bouwe.io/bouwe-react-amsterdam.png"
    />
    <meta name="twitter:image:alt" content="Bouwe Westerdijk" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <link rel="stylesheet" href="/styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Open Sans"
    />
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.1/build/styles/atom-one-dark-reasonable.min.css"
    />
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.1/build/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
    <link
      href="/rss2.xml"
      type="application/rss+xml"
      rel="alternate"
      title="bouwe.io RSS Feed"
    />
    <link
      href="/atom.xml"
      type="application/atom+xml"
      rel="alternate"
      title="bouwe.io Atom feed"
    />
  </head>

  <body>
    <div>
      <header class="header">
        <div class="container">
          <div class="header-container">
            <div class="logo">
              <h1>
                <a href="/"
                  ><span class="logo-part1">bouwe</span
                  ><span class="logo-part2">.io</span></a
                >
              </h1>
            </div>
            <div class="nav"><ul class='nav-list'><li class='nav-item'><a href="/about" class='nav-inactive'>about</a></li><li class='nav-item'><a href="/blog" class='nav-inactive'>blog</a></li><li class='nav-item'><a href="/videos" class='nav-inactive'>videos</a></li><li class='nav-item'><a href="/contact" class='nav-inactive'>contact</a></li></ul></div>
          </div>
        </div>
      </header>
  
          <div class="main">
      <div class="container">
              <div>
        <h2 class="page-title">Using a state machine</h2>
      </div>

      <div><h3>Introduction</h3>
<p>In this series about introducing state machines I will start with writing about how to use (call) a state machine.</p>
<p>If you don't know what a state machine is, or how to create one, this might sound strange. How can I use something when I haven't even build it yet?</p>
<p>Well, I think by calling state machines, you first start thinking about <em>what</em> you want to achieve with them, and only then, after that, <em>how</em> you want build them. Building a state machine can be challenging, while using it is pretty straightforward.</p>
<p>Also by calling it first, you can determine it is even usable, and you can define the requirements to determine if it works. So what we are basically doing here is kind of a test driven approach, which is very beneficial when you know <em>what</em> you want, but not necessarily yet <em>how</em>.</p>
<h3>A light switch</h3>
<p>Let's keep it simple and build a light switch. At any given point in time, the light is either on or off. It can not be something else than on or off, and it can also not be both on and off at the same time. Also, we need to have a way to know, or to ask, the light switch whether it is currently on or off.</p>
<p>This means on and off are the <em>finite states</em> of our state machine.</p>
<p>Let's start coding by using the light switch and asking it whether it is on or off:</p>
<pre><code>const lightSwitch = new LightSwitch()
console.log(lightSwitch.state) // "off"
</code></pre>
<blockquote>
<p>I am using an object oriented approach here, because I think it's the easiest to begin with introducing state machines.
Personally I prefer and use state machines in a more functional coding style, so I will definitely do some writing about that later.</p>
</blockquote>
<h3>Switching on or off</h3>
<p>OK, so the light is off. How do we switch it on? Let's call a <code>switchOn</code> method on the <code>lightSwitch</code> object. Oh, and while we are at it, let's also switching it off again:</p>
<pre><code>const lightSwitch = new LightSwitch()
console.log(lightSwitch.state) // "off"

lightSwitch.switchOn()
console.log(lightSwitch.state) // "on"

lightSwitch.switchOff()
console.log(lightSwitch.state) // "off"
</code></pre>
<p><code>switchOn</code> or <code>switchOff</code> are the only inputs our state machines expects. When calling them, the state of our light switch machine <em>transitions</em> from one state to the other.</p>
<h3>... transitions</h3>
<p>When implementing state machines, it is very common to only define what you do want to happen. There is no need to prevent things from happening, or even to throw errors when a state machines gets unexpected inputs.</p>
<p>So for example, when the light is on, and you call <code>switchOn</code> again, nothing should happen, because it is already on. And of course the same for <code>switchOff</code>.</p>
<p>To make our code even nicer, let's have <code>switchOn</code> and <code>switchOff</code> return the state the light switch is in, after calling them:</p>
<pre><code>const lightSwitch = new LightSwitch()
console.log(lightSwitch.state) // "off"

let state = lightSwitch.switchOn()
console.log(state) // "on"
lightSwitch.switchOn()
console.log(lightSwitch.state) // "on"

lightSwitch.switchOff()
console.log(lightSwitch.state) // "off"
state = lightSwitch.switchOff()
console.log(state) // "off"
</code></pre>
<p>With this, we can determine the current state anytime, by calling the <code>lightSwitch.state</code> getter, but we also get it back after changing the state.</p>
<h3>Testing</h3>
<p>As we have specified how to use the <code>LightSwitch</code>, and also what we expect from it, let's turn our code into a poor man's test suite by calling <code>console.assert</code>:</p>
<pre><code>const lightSwitch = new LightSwitch()
console.assert(lightSwitch.state === "off", "light should be off")

let state = lightSwitch.switchOn()
console.assert(state === "on", "light should be on")
lightSwitch.switchOn()
console.assert(lightSwitch.state === "on", "light should be on")

lightSwitch.switchOff()
console.assert(lightSwitch.state === "off", "light should be off")
state = lightSwitch.switchOff()
console.assert(state === "off", "light should be off")
</code></pre>
<p>So whenever an assertion fails, the message passed as second argument to <code>console.assert</code> is written to the console. If the assertion passes, nothing is written to the console. When running this code, no news is good news.</p>
<h3>Implementing the light switch</h3>
<p>Our "test suite" of course does not work, because we haven't implemented the <code>LightSwitch</code> class yet. Here is a nice and simple implementation:</p>
<pre><code>type LightSwitchState = "on" | "off";

class LightSwitch {
  private _state: LightSwitchState;

  constructor() {
    this._state = "off";
  }

  public switchOn(): LightSwitchState {
    if (this._state !== "on") this._state = "on";
    return this._state
  }

  public switchOff(): LightSwitchState {
    if (this._state !== "off") this._state = "off";
    return this._state
  }

  public get state(): LightSwitchState {
    return this._state;
  }
}
</code></pre>
<h3>Conclusion</h3>
<p>All our tests pass, so we are done, right? Well yes, but maybe this implementation is a bit overkill. I mean, is it really necessary to build a light switch as a state machine?</p>
<p>Probably not. And then I haven't even used the state pattern yet, which is the official way of building state machines when you are doing object oriented programming. That would make our code even longer.</p>
<p>The state pattern, and of course state machines in general, really shine if you need to implement more complex behavior. But I hope this simple example gave you a nice intro into state machines.</p>
</div>

            <div>
        <a
          href="https://twitter.com/intent/tweet?text=Using a state machine&url=https://bouwe.io/using-a-state-machine&via=bouwe"
          >Share on Twitter</a
        >
        ·
        <a href="https://twitter.com/search?q=https://bouwe.io/using-a-state-machine"
          >Discuss on Twitter</a
        >
        ·
        <a href="https://github.com/bouwe77/bouwe.io/edit/master/content/pages/using-a-state-machine.md">Edit on GitHub</a>
      </div>

      </div>
    </div>

    <footer></footer>
  

    </div>

    <!-- Default Statcounter code for bouwe.io https://bouwe.io -->
    <script type="text/javascript">
    var sc_project=12847572; 
    var sc_invisible=1; 
    var sc_security="f729e1b5"; 
    </script>
    <script type="text/javascript"
    src="https://www.statcounter.com/counter/counter.js" async></script>
    <noscript><div class="statcounter"><a title="Web Analytics"
    href="https://statcounter.com/" target="_blank"><img class="statcounter"
    src="https://c.statcounter.com/12847572/0/f729e1b5/1/" alt="Web Analytics"
    referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
    <!-- End of Statcounter Code -->
    
  </body>
</html>
